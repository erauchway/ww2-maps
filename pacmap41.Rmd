---
title: "Pacific Map, summer 1941"
author: "Eric Rauchway"
date: "6/9/2022"
output: html_document
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE, results = "hide", fig.height = 14, fig.width = 14, fig.retina = 3}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results = "hide")

library(tidyverse)
library(sf)
library(cowplot)
library(ggtext)
theme_set(theme_void() +
           theme(legend.position = "bottom",
                  text = element_text(family = "Futura Medium"),
                  plot.title = element_markdown(size = rel(1.0), hjust = 1, vjust = -10),
                  plot.subtitle = element_markdown(size = rel(0.8)),
                  legend.title = element_text(size = rel(0.5)),
                  legend.text = element_text(size = rel(0.6)),
                  plot.caption = element_markdown(hjust = 0, size = rel(0.5)),
                 panel.background = element_rect(fill = "#f7fdff", color = "#f7fdff")))
target_crs = "EPSG:3832"

pacmap <- st_read("pacmap41.geojson")

status <- read_csv("pacnames.csv")

pacmap <- left_join(pacmap, status)

pacmap <- pacmap %>%
  mutate(pacmap, status_ord = factor(status, levels = c("Axis",
                                                         "Axis-occupied",
                                                         "Neutral",
                                                         "Allies",
                                                        "USA",
                                                         ordered = TRUE)))
pacmap <- st_as_sf(pacmap)

mypal = c("#70a494", "#b4c8a8", "#f6edbd", "#ca562c", "#A16928") 

pacmap <- cbind(pacmap, st_coordinates(st_centroid(pacmap)))

majlab <- pacmap[which(pacmap$maj == 4),]
minlab <- pacmap[which(pacmap$maj == 3),]
miclab <- pacmap[which(pacmap$maj == 2),]

disp_win_wgs84 <- st_sfc(st_point(c(93, -50)), st_point(c(250, 58)), crs = 4326)
disp_win_trans <- st_transform(disp_win_wgs84, crs = target_crs)
disp_win_coord <- st_coordinates(disp_win_trans)

p <- ggplot(pacmap, color = alpha(c("black"),0.5)) + geom_sf(data = pacmap, mapping = aes(fill = status_ord), alpha = .6, size = 0.2) 
p + scale_fill_manual(values = mypal)  +
  scale_color_manual(values = mypal)  +
  guides(fill = guide_legend(ncol = 5))  +
  coord_sf(xlim = disp_win_coord[,'X'], ylim = disp_win_coord[, 'Y'], datum = target_crs, expand = FALSE)  +
  geom_richtext(data = majlab, inherit.aes = FALSE, mapping = aes(X, Y, label = mylabels), family = "Futura Medium", size = 5, fill = NA, label.color = NA, nudge_x = majlab$nx, nudge_y = majlab$ny, na.rm = TRUE) +
  geom_richtext(data = minlab, inherit.aes = FALSE, mapping = aes(X, Y, label = mylabels), family = "Futura Medium", size = 4, fill = NA, label.color = NA, nudge_x = minlab$nx, nudge_y = minlab$ny, na.rm = TRUE) +
  geom_richtext(data = miclab, inherit.aes = FALSE, mapping = aes(X, Y, label = mylabels), family = "Futura Medium", size = 3, fill = NA, label.color = NA, nudge_x = miclab$nx, nudge_y = miclab$ny, na.rm = TRUE) +
  geom_text(x = 80000,
            y = -1900000,
            color = "lightskyblue2",
            family = "Futura Medium Italic",
            size = 5,
            hjust = 0,
            label = "Coral Sea") +
  geom_richtext(x = 1000000,
            y = 2000000,
            color = "lightskyblue2",
            family = "Futura Medium Italic",
            size = 9,
            hjust = 0,
            fill = NA,
            label.color = NA,
            label = "Pacific Ocean") +
  geom_text( x = 6000000,
             y = -5000000,
             hjust = 0,
             color = "black",
             label = "Status of territory as of summer 1941",
             family = "Futura Medium Italic",
             size = 4) +
  theme(legend.position = c(0.827, 0.06),
        legend.text = element_text(family = "Futura Medium", color = "black", size = 8),
        legend.title = element_text(family = "Futura Medium", color = "black", size = 9)) +
  
  labs(fill = "")
```